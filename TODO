Deployment needs. Below assumes a single logshipper in tools.

Possibly (not deployment) use the Record Modifier plugin to add New
Relic GUIDs: https://docs.fluentbit.io/manual/pipeline/filters/record-modifier

Initial setup: 

  * Credential services (in tools space):
     New Relic ( -t "newrelic-creds" )
     Log storage ( -t "logshipper-s3" )
     create-basic-auth-creds

  * push-app

  * create a known route and bind it, e.g.,
     cf create-route app.cloud.gov --hostname usagov-tools-logshipper
     cf map-route fluentbit-drain usagov-tools-logshipper.app.cloud.gov

  * bind-services

  * set-proxyroute

  * create-log-drains (happens in every env, skips log-shipper app) 



set-proxyroute

  * set PROXYROUTE and restart -- get proxy_route from
    egress app as in setup-egress-for-apps. We don't need the rest. 

create-basic-auth-creds:
   * Use HTTP_USER, HTTP_PASS credentials from env. 
   * Create or update logshipper-creds service ( -t "logshipper-creds" )


Rotate basic auth (SKIP FOR NOW) :
   TODO: Add logic to cg-logshipper to manage multiple basic auth credentials for rotation
   * create-basic-auth-creds
   * update-log-drains

create-log-drains:
   Do for (dev, stage, prod, shared-egress) 
   * get-basic-auth-creds  PUNT, get from env
   * TODO: get URL for drain
   * create log drain service
   * get all apps in space
      * bind log drain to each app


update-log-drains:
   Do for (dev, stage, prod, shared-egress) 
   * get-basic-auth-creds
   * TODO: get URL for drain   
   * update log drain service  

==================================================
DONE:

regular deploy:

  * push-app

push-app:

  * existing bin/deploy script 

